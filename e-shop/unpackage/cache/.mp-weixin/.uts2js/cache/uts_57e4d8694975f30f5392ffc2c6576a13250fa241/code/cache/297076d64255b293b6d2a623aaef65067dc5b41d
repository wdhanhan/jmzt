{"code":"import { defineComponent } from \"vue\";\nimport CatPopup from \"@/components/CatPopup/CatPopup.uvue\";\nconst API_BASE = \"https://wdxwhdglzx.jzzw-tech.cn\";\nexport default defineComponent({\n    components: {\n        CatPopup,\n    },\n    props: {\n        // 直接用后端 /api/products/:id 返回的 data\n        info: {\n            type: Object,\n            default() {\n                return new UTSJSONObject({\n                    id: 0,\n                    name: \"\",\n                    price: 0,\n                    pic: \"\",\n                    images: [],\n                    skus: [],\n                });\n            },\n        },\n    },\n    data() {\n        return {\n            statusBarBottom: 0,\n            btnType: \"\",\n            selectedSkuIndex: 0,\n            quantity: 1, // 数量\n        };\n    },\n    mounted() {\n        const windowInfo = uni.getWindowInfo();\n        this.statusBarBottom = windowInfo.safeAreaInsets\n            ? windowInfo.safeAreaInsets.bottom\n            : 0;\n        // 默认选中第一个 sku\n        if (this.info && this.info.skus && this.info.skus.length > 0) {\n            this.selectedSkuIndex = 0;\n        }\n    },\n    computed: {\n        // 当前选中的 sku\n        currentSku() {\n            if (this.info && this.info.skus && this.info.skus.length > 0) {\n                return this.info.skus[this.selectedSkuIndex] || new UTSJSONObject({});\n            }\n            return new UTSJSONObject({});\n        },\n        // 顶部展示图片：优先 sku.image → info.images[0] → info.pic\n        displayPic() {\n            if (this.currentSku && this.currentSku.image) {\n                return this.currentSku.image;\n            }\n            if (this.info && this.info.images && this.info.images.length > 0) {\n                return this.info.images[0];\n            }\n            return this.info.pic || \"\";\n        },\n        // 顶部展示价格：优先 sku.price → info.price\n        displayPrice() {\n            if (this.currentSku && this.currentSku.price) {\n                return this.currentSku.price;\n            }\n            return this.info.price || 0;\n        },\n        // “已选：xxx”\n        selectedSkuText() {\n            if (!this.info.skus || this.info.skus.length === 0) {\n                return \"默认规格\";\n            }\n            const sku = this.currentSku;\n            if (!sku)\n                return \"默认规格\";\n            return sku.sku_name || \"默认规格\";\n        },\n    },\n    methods: {\n        /**\n         * 外部调用：打开弹窗\n         * type: 'cart' | 'buy'\n         */\n        open(type = null) {\n            this.btnType = type || \"buy\";\n            if (!this.info.skus || this.info.skus.length === 0) {\n                this.selectedSkuIndex = 0;\n            }\n            else if (this.selectedSkuIndex >= this.info.skus.length) {\n                this.selectedSkuIndex = 0;\n            }\n            this.quantity = 1;\n            if (this.$refs.CatPopup && this.$refs.CatPopup.$callMethod) {\n                this.$refs.CatPopup.$callMethod(\"open\");\n            }\n        },\n        close() {\n            if (this.$refs.CatPopup && this.$refs.CatPopup.$callMethod) {\n                this.$refs.CatPopup.$callMethod(\"close\");\n            }\n        },\n        // 选择 SKU\n        selectSku(index = null) {\n            this.selectedSkuIndex = index;\n        },\n        // 改数量\n        changeQty(delta = null) {\n            const next = this.quantity + delta;\n            if (next < 1)\n                return null;\n            this.quantity = next;\n        },\n        // ⭐⭐ 加入购物车：真正调用 /api/cart/add\n        onAddCart() {\n            if (!this.currentSku || !this.currentSku.sku_id) {\n                uni.showToast({ title: \"请选择规格\", icon: \"none\" });\n                return null;\n            }\n            const openid = uni.getStorageSync(\"openid\");\n            if (!openid) {\n                uni.showToast({ title: \"请先登录\", icon: \"none\" });\n                return null;\n            }\n            const skuId = this.currentSku.sku_id;\n            const qty = this.quantity;\n            uni.showLoading({ title: \"加入中...\" });\n            uni.request({\n                url: `${API_BASE}/api/cart/add`,\n                method: \"POST\",\n                header: new UTSJSONObject({\n                    \"content-type\": \"application/json\",\n                }),\n                data: new UTSJSONObject({\n                    openid: openid,\n                    sku_id: skuId,\n                    quantity: qty,\n                }),\n                success: (res) => {\n                    const body = res.data || {};\n                    if (body.code === 200) {\n                        uni.showToast({\n                            title: body.msg || \"已加入购物车\",\n                            icon: \"success\",\n                        });\n                        this.close();\n                    }\n                    else {\n                        uni.showToast({\n                            title: body.msg || \"加入购物车失败\",\n                            icon: \"none\",\n                        });\n                    }\n                },\n                fail: () => {\n                    uni.showToast({\n                        title: \"网络错误，请稍后重试\",\n                        icon: \"none\",\n                    });\n                },\n                complete: () => {\n                    uni.hideLoading();\n                },\n            });\n        },\n        formatSkuName(sku = null, index = null) {\n            const name = sku.sku_name || \"规格 \" + (index + 1);\n            return name.replace(/\\//g, \"\");\n        },\n        // 立即购买\n        onBuy() {\n            if (!this.currentSku || !this.currentSku.sku_id) {\n                uni.showToast({ title: \"请选择规格\", icon: \"none\" });\n                return null;\n            }\n            const goodsId = this.info.id || 0;\n            const sku = this.currentSku;\n            const qty = this.quantity;\n            const orderItem = new UTSJSONObject({\n                product_id: goodsId,\n                sku_id: sku.sku_id,\n                name: this.info.name,\n                sku_name: sku.sku_name || this.selectedSkuText,\n                price: sku.price || this.info.price || 0,\n                quantity: qty,\n                image: sku.image || this.displayPic,\n                attr1: sku.attr1,\n                attr2: sku.attr2,\n                attr3: sku.attr3,\n                attr4: sku.attr4,\n            });\n            uni.navigateTo({\n                url: \"/pages/ConfirmOrder/ConfirmOrder\",\n                success: (res) => {\n                    const eventChannel = res.eventChannel;\n                    eventChannel.emit(\"orderData\", new UTSJSONObject({\n                        items: [orderItem],\n                        from: \"goodsDetail\",\n                    }));\n                },\n            });\n        },\n    },\n});\n//# sourceMappingURL=C:/Users/%E8%8B%A5%E6%B6%B5/Desktop/%E6%8E%A5%E5%8D%95/e-shop/pages/GoodsDetail/components/AttrPopup/AttrPopup.uvue?vue&type=script&lang.uts.js.map","references":["C:/Users/若涵/Desktop/接单/e-shop/components/CatPopup/CatPopup.uvue.ts"],"uniExtApis":["uni.getWindowInfo","uni.showToast","uni.getStorageSync","uni.showLoading","uni.hideLoading","uni.request","uni.navigateTo"],"map":"{\"version\":3,\"file\":\"AttrPopup.uvue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"AttrPopup.uvue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
