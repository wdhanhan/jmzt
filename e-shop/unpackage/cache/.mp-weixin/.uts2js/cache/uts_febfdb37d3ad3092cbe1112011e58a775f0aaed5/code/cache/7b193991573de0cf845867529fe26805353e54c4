{"code":"import { defineComponent } from \"vue\";\nconst API_BASE = 'https://wdxwhdglzx.jzzw-tech.cn';\nexport default defineComponent({\n    data() {\n        return {\n            statusBarHeight: 0,\n            loading: false,\n            errorMsg: '',\n            // 后端返回的两个核心列表\n            refundableList: [],\n            processingList: [],\n            // 弹窗相关\n            showReasonPopup: false,\n            currentOrder: null,\n            refundReason: '',\n        };\n    },\n    onLoad() {\n        const win = uni.getWindowInfo();\n        this.statusBarHeight = win.statusBarHeight;\n        this.loadRefundOrders();\n    },\n    methods: {\n        // 返回\n        onBack() {\n            uni.navigateBack();\n        },\n        // 加载可申请退款 & 退款中的订单\n        loadRefundOrders() {\n            const openid = uni.getStorageSync('openid');\n            if (!openid) {\n                this.errorMsg = '未找到 openid，请先登录后再试';\n                uni.showToast({\n                    title: '请先登录',\n                    icon: 'none',\n                });\n                return null;\n            }\n            this.loading = true;\n            this.errorMsg = '';\n            uni.request({\n                url: `${API_BASE}/api/order/refund/list`,\n                method: 'GET',\n                data: new UTSJSONObject({ openid }),\n                success: (res) => {\n                    const body = res.data || {};\n                    if (body.code !== 200) {\n                        this.errorMsg = body.msg || '接口返回错误';\n                        return null;\n                    }\n                    const data = body.data || {};\n                    this.refundableList = data.refundable_orders || [];\n                    this.processingList = data.refund_processing_orders || [];\n                },\n                fail: () => {\n                    this.errorMsg = '网络请求失败，请稍后重试';\n                },\n                complete: () => {\n                    this.loading = false;\n                },\n            });\n        },\n        // 格式化金额\n        formatAmount(v = null) {\n            const n = Number(v || 0);\n            return n.toFixed(2);\n        },\n        // +8 小时的时间格式化\n        formatTimePlus8(t = null) {\n            if (!t)\n                return '—';\n            const d = new Date(t);\n            if (isNaN(d.getTime()))\n                return String(t);\n            const ts = d.getTime();\n            const dd = new Date(ts);\n            const y = dd.getFullYear();\n            const m = (dd.getMonth() + 1).toString().padStart(2, '0');\n            const day = dd.getDate().toString().padStart(2, '0');\n            const hh = dd.getHours().toString().padStart(2, '0');\n            const mm = dd.getMinutes().toString().padStart(2, '0');\n            const ss = dd.getSeconds().toString().padStart(2, '0');\n            return `${y}-${m}-${day} ${hh}:${mm}:${ss}`;\n        },\n        // 从 items_snapshot 里取出第一个课程名称\n        getFirstItemName(order = null) {\n            if (!order || !order.items_snapshot)\n                return '课程';\n            try {\n                const arr = UTS.JSON.parse(order.items_snapshot);\n                if (Array.isArray(arr) && arr.length > 0) {\n                    const it = arr[0];\n                    return it.product_name || it.name || '课程';\n                }\n            }\n            catch (e) { }\n            return '课程';\n        },\n        // 打开原因弹窗\n        openReasonPopup(order = null) {\n            this.currentOrder = order;\n            this.refundReason = '';\n            this.showReasonPopup = true;\n        },\n        // 关闭弹窗\n        closeReasonPopup() {\n            this.showReasonPopup = false;\n            this.currentOrder = null;\n            this.refundReason = '';\n        },\n        // 提交退款申请\n        submitRefund() {\n            if (!this.currentOrder)\n                return null;\n            const reason = this.refundReason.trim();\n            if (!reason || reason.length < 5) {\n                uni.showToast({\n                    title: '请至少填写 5 个字的退款原因',\n                    icon: 'none',\n                });\n                return null;\n            }\n            const openid = uni.getStorageSync('openid');\n            if (!openid) {\n                uni.showToast({\n                    title: '请先登录',\n                    icon: 'none',\n                });\n                return null;\n            }\n            uni.showLoading({ title: '提交中...' });\n            uni.request({\n                url: `${API_BASE}/api/order/refund/apply`,\n                method: 'POST',\n                header: new UTSJSONObject({\n                    'content-type': 'application/json',\n                }),\n                data: new UTSJSONObject({\n                    openid,\n                    order_id: this.currentOrder.id,\n                    reason: reason,\n                }),\n                success: (res) => {\n                    const body = res.data || {};\n                    if (body.code === 200) {\n                        uni.showToast({\n                            title: '申请已提交',\n                            icon: 'success',\n                        });\n                        this.closeReasonPopup();\n                        this.loadRefundOrders();\n                    }\n                    else {\n                        uni.showToast({\n                            title: body.msg || '申请失败',\n                            icon: 'none',\n                        });\n                    }\n                },\n                fail: () => {\n                    uni.showToast({\n                        title: '网络错误，请稍后再试',\n                        icon: 'none',\n                    });\n                },\n                complete: () => {\n                    uni.hideLoading();\n                },\n            });\n        },\n    },\n});\n//# sourceMappingURL=C:/Users/%E8%8B%A5%E6%B6%B5/Desktop/%E6%8E%A5%E5%8D%95/e-shop/pages/AfterSale/AfterSale.uvue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.getWindowInfo","uni.navigateBack","uni.getStorageSync","uni.showToast","uni.request","uni.showLoading","uni.hideLoading"],"map":"{\"version\":3,\"file\":\"AfterSale.uvue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"AfterSale.uvue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
