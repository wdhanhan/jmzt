{"code":"import { defineComponent } from \"vue\";\nconst API_BASE = 'https://wdxwhdglzx.jzzw-tech.cn';\nclass WxPhoneNumberData extends UTS.UTSType {\n    static get$UTSMetadata$() {\n        return {\n            kind: 2,\n            get fields() {\n                return {\n                    phoneNumber: { type: String, optional: false },\n                    purePhoneNumber: { type: String, optional: true },\n                    countryCode: { type: String, optional: true }\n                };\n            },\n            name: \"WxPhoneNumberData\"\n        };\n    }\n    constructor(options, metadata = WxPhoneNumberData.get$UTSMetadata$(), isJSONParse = false) {\n        super();\n        this.__props__ = UTS.UTSType.initProps(options, metadata, isJSONParse);\n        this.phoneNumber = this.__props__.phoneNumber;\n        this.purePhoneNumber = this.__props__.purePhoneNumber;\n        this.countryCode = this.__props__.countryCode;\n        delete this.__props__;\n    }\n}\nclass PhoneApiResponse extends UTS.UTSType {\n    static get$UTSMetadata$() {\n        return {\n            kind: 2,\n            get fields() {\n                return {\n                    code: { type: Number, optional: false },\n                    msg: { type: String, optional: true },\n                    data: { type: WxPhoneNumberData, optional: true }\n                };\n            },\n            name: \"PhoneApiResponse\"\n        };\n    }\n    constructor(options, metadata = PhoneApiResponse.get$UTSMetadata$(), isJSONParse = false) {\n        super();\n        this.__props__ = UTS.UTSType.initProps(options, metadata, isJSONParse);\n        this.code = this.__props__.code;\n        this.msg = this.__props__.msg;\n        this.data = this.__props__.data;\n        delete this.__props__;\n    }\n}\nclass GetPhoneNumberResult extends UTS.UTSType {\n    static get$UTSMetadata$() {\n        return {\n            kind: 2,\n            get fields() {\n                return {\n                    code: { type: String, optional: true },\n                    errMsg: { type: String, optional: true }\n                };\n            },\n            name: \"GetPhoneNumberResult\"\n        };\n    }\n    constructor(options, metadata = GetPhoneNumberResult.get$UTSMetadata$(), isJSONParse = false) {\n        super();\n        this.__props__ = UTS.UTSType.initProps(options, metadata, isJSONParse);\n        this.code = this.__props__.code;\n        this.errMsg = this.__props__.errMsg;\n        delete this.__props__;\n    }\n}\nclass GetPhoneNumberEvent extends UTS.UTSType {\n    static get$UTSMetadata$() {\n        return {\n            kind: 2,\n            get fields() {\n                return {\n                    detail: { type: GetPhoneNumberResult, optional: false }\n                };\n            },\n            name: \"GetPhoneNumberEvent\"\n        };\n    }\n    constructor(options, metadata = GetPhoneNumberEvent.get$UTSMetadata$(), isJSONParse = false) {\n        super();\n        this.__props__ = UTS.UTSType.initProps(options, metadata, isJSONParse);\n        this.detail = this.__props__.detail;\n        delete this.__props__;\n    }\n}\n// ---------------------------------------------------\nexport default defineComponent({\n    data() {\n        return {\n            phone: '',\n            hasPhone: false,\n            loading: false,\n        };\n    },\n    computed: {\n        displayPhone() {\n            if (!this.phone || this.phone.length < 7) {\n                return this.phone;\n            }\n            const p = this.phone;\n            return p.substring(0, 3) + '****' + p.substring(7);\n        },\n    },\n    onLoad() {\n        const cachePhone = uni.getStorageSync('mobile');\n        if (cachePhone != null && cachePhone !== '') {\n            this.phone = cachePhone;\n            this.hasPhone = true;\n        }\n    },\n    methods: {\n        onGetPhoneNumber(e) {\n            if (this.loading)\n                return null;\n            const detail = e.detail;\n            const code = detail.code;\n            const errMsg = detail.errMsg;\n            // 微信按钮返回失败 或 用户取消\n            if (!code || (errMsg != null && !errMsg.endsWith(':ok'))) {\n                uni.showToast({\n                    title: '您取消了手机号授权',\n                    icon: 'none',\n                });\n                return null;\n            }\n            // ⭐ openid 必传\n            const openid = uni.getStorageSync('openid');\n            if (openid == null || openid === '') {\n                uni.showToast({\n                    title: '缺少 openid，请先完成登录',\n                    icon: 'none',\n                });\n                return null;\n            }\n            this.loading = true;\n            uni.request({\n                url: `${API_BASE}/api/wx/phone`,\n                method: 'POST',\n                header: new UTSJSONObject({\n                    'content-type': 'application/json',\n                }),\n                data: new UTSJSONObject({\n                    code: code,\n                    openid: openid, // ⭐ openid 必传\n                }),\n                success: (resp) => {\n                    var _a;\n                    const body = resp.data;\n                    if (body.code === 200 && body.data != null && body.data.phoneNumber) {\n                        const mobile = body.data.phoneNumber;\n                        this.phone = mobile;\n                        this.hasPhone = true;\n                        uni.setStorageSync('mobile', mobile);\n                        uni.showToast({\n                            title: '手机号获取成功',\n                            icon: 'success',\n                        });\n                    }\n                    else {\n                        const msg = (_a = body.msg) !== null && _a !== void 0 ? _a : '获取手机号失败';\n                        uni.showToast({\n                            title: msg,\n                            icon: 'none',\n                        });\n                    }\n                },\n                fail: () => {\n                    uni.showToast({\n                        title: '网络错误，请稍后重试',\n                        icon: 'none',\n                    });\n                },\n                complete: () => {\n                    this.loading = false;\n                },\n            });\n        },\n    },\n});\n//# sourceMappingURL=C:/Users/%E8%8B%A5%E6%B6%B5/Desktop/%E6%8E%A5%E5%8D%95/e-shop/pages/login/login.uvue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.getStorageSync","uni.showToast","uni.setStorageSync","uni.request"],"map":"{\"version\":3,\"file\":\"login.uvue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"login.uvue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
