{"code":"import { defineComponent } from \"vue\";\nconst WX_APPID = 'wx2ee0ec34076f93e6';\nconst WX_MCHID = '1738346388';\nconst PAY_URL = 'https://jmpay.cxxyonline.cn/';\nexport default defineComponent({\n    data() {\n        return {\n            statusBarHeight: 0,\n            submitting: false,\n            mobile: uni.getStorageSync('mobile') || '',\n            createTime: '',\n            // 核心参数：全部由上个页面传入\n            amount: 0,\n            payDesc: '',\n            payType: '' // 支付类型 (如：light_month)\n        };\n    },\n    onLoad(options = null) {\n        const windowInfo = uni.getWindowInfo();\n        this.statusBarHeight = windowInfo.statusBarHeight || 0;\n        // 生成当前时间用于展示\n        const now = new Date();\n        this.createTime = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;\n        // 接收参数\n        if (options.amount)\n            this.amount = parseFloat(options.amount);\n        if (options.desc)\n            this.payDesc = decodeURIComponent(options.desc);\n        if (options.type)\n            this.payType = options.type;\n        // 安全校验\n        if (this.amount <= 0) {\n            uni.showToast({ title: '参数错误:金额无效', icon: 'none' });\n            setTimeout(() => { return uni.navigateBack(); }, 1500);\n        }\n    },\n    methods: {\n        formatPrice(v) {\n            const s = (v || 0).toFixed(2);\n            const arr = s.split('.');\n            return new UTSJSONObject({ int: arr[0], dec: arr[1] || '00' });\n        },\n        getTypeName(type) {\n            const map = new UTSJSONObject({\n                'light_month': '轻月卡开通',\n                'heavy_month': '重月卡充值',\n                'times_year': '分次年卡',\n                'free_year': '自由年卡',\n                'recharge': '余额充值'\n            });\n            return map[type] || '增值服务';\n        },\n        handlePay() {\n            if (this.submitting)\n                return null;\n            this.submitting = true;\n            // 生成订单号前缀\n            const prefix = this.payType === 'recharge' ? 'RE' : 'ME';\n            const outTradeNo = prefix + Date.now();\n            uni.__f__('log', 'at pages/chongzhi/chongzhi.uvue:120', '发起支付:', this.amount, this.payType);\n            uni.request({\n                url: PAY_URL,\n                method: 'POST',\n                data: new UTSJSONObject({\n                    appid: WX_APPID,\n                    mchid: WX_MCHID,\n                    description: this.payDesc,\n                    outTradeNo: outTradeNo,\n                    total: Math.round(this.amount * 100),\n                    openid: uni.getStorageSync('openid'),\n                    attach: this.payType\n                }),\n                success: (res = null) => {\n                    if (res.statusCode !== 200) {\n                        this.showErr('服务暂不可用');\n                        return null;\n                    }\n                    const p = res.data;\n                    uni.requestPayment({\n                        timeStamp: String(p.timeStamp),\n                        nonceStr: p.nonceStr,\n                        package: p.package,\n                        signType: 'RSA',\n                        paySign: p.paySign,\n                        success: () => {\n                            uni.showToast({ title: '支付成功', icon: 'success' });\n                            setTimeout(() => {\n                                // 支付成功逻辑：如果是充值返回上一页，如果是买会员去会员页\n                                if (this.payType === 'recharge')\n                                    uni.navigateBack();\n                                else\n                                    uni.redirectTo({ url: '/pages/member/status' });\n                            }, 1500);\n                        },\n                        fail: () => {\n                            uni.showToast({ title: '已取消支付', icon: 'none' });\n                        }\n                    });\n                },\n                fail: () => {\n                    this.showErr('网络连接失败');\n                },\n                complete: () => {\n                    this.submitting = false;\n                }\n            });\n        },\n        showErr(msg) {\n            uni.showModal(new UTSJSONObject({ title: '提示', content: msg, showCancel: false }));\n        }\n    }\n});\n//# sourceMappingURL=C:/Users/zrh/Desktop/7600/e-shop/pages/chongzhi/chongzhi.uvue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.getStorageSync","uni.getWindowInfo","uni.showToast","uni.navigateBack","uni.__f__","uni.redirectTo","uni.requestPayment","uni.request","uni.showModal"],"map":"{\"version\":3,\"file\":\"chongzhi.uvue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"chongzhi.uvue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
