{"code":"import { defineComponent } from \"vue\";\nclass SkuSnapshot extends UTS.UTSType {\n    static get$UTSMetadata$() {\n        return {\n            kind: 2,\n            get fields() {\n                return {\n                    product_id: { type: Number, optional: false },\n                    sku_id: { type: Number, optional: false },\n                    name: { type: String, optional: false },\n                    sku_name: { type: String, optional: false },\n                    price: { type: String, optional: false },\n                    quantity: { type: Number, optional: false },\n                    image: { type: String, optional: true },\n                    attr1: { type: String, optional: true },\n                    attr2: { type: String, optional: true },\n                    attr3: { type: String, optional: true },\n                    attr4: { type: String, optional: true }\n                };\n            },\n            name: \"SkuSnapshot\"\n        };\n    }\n    constructor(options, metadata = SkuSnapshot.get$UTSMetadata$(), isJSONParse = false) {\n        super();\n        this.__props__ = UTS.UTSType.initProps(options, metadata, isJSONParse);\n        this.product_id = this.__props__.product_id;\n        this.sku_id = this.__props__.sku_id;\n        this.name = this.__props__.name;\n        this.sku_name = this.__props__.sku_name;\n        this.price = this.__props__.price;\n        this.quantity = this.__props__.quantity;\n        this.image = this.__props__.image;\n        this.attr1 = this.__props__.attr1;\n        this.attr2 = this.__props__.attr2;\n        this.attr3 = this.__props__.attr3;\n        this.attr4 = this.__props__.attr4;\n        delete this.__props__;\n    }\n}\nclass OrderItem extends UTS.UTSType {\n    static get$UTSMetadata$() {\n        return {\n            kind: 2,\n            get fields() {\n                return {\n                    id: { type: Number, optional: false },\n                    order_no: { type: String, optional: false },\n                    user_id: { type: String, optional: false },\n                    user_name: { type: String, optional: false },\n                    id_card_no: { type: String, optional: false },\n                    student_school: { type: String, optional: true },\n                    student_grade: { type: String, optional: true },\n                    mobile: { type: String, optional: true },\n                    total_amount: { type: String, optional: false },\n                    pay_amount: { type: String, optional: false },\n                    status: { type: Number, optional: false },\n                    refund_status: { type: Number, optional: false },\n                    refund_amount: { type: String, optional: false },\n                    refund_time: { type: String, optional: true },\n                    audit_status: { type: Number, optional: false },\n                    receiver_name: { type: String, optional: true },\n                    receiver_mobile: { type: String, optional: true },\n                    receiver_address: { type: String, optional: true },\n                    items_snapshot: { type: String, optional: true },\n                    created_at: { type: String, optional: false },\n                    pay_time: { type: String, optional: true },\n                    items: { type: UTS.UTSType.withGenerics(Array, [SkuSnapshot]), optional: true }\n                };\n            },\n            name: \"OrderItem\"\n        };\n    }\n    constructor(options, metadata = OrderItem.get$UTSMetadata$(), isJSONParse = false) {\n        super();\n        this.__props__ = UTS.UTSType.initProps(options, metadata, isJSONParse);\n        this.id = this.__props__.id;\n        this.order_no = this.__props__.order_no;\n        this.user_id = this.__props__.user_id;\n        this.user_name = this.__props__.user_name;\n        this.id_card_no = this.__props__.id_card_no;\n        this.student_school = this.__props__.student_school;\n        this.student_grade = this.__props__.student_grade;\n        this.mobile = this.__props__.mobile;\n        this.total_amount = this.__props__.total_amount;\n        this.pay_amount = this.__props__.pay_amount;\n        this.status = this.__props__.status;\n        this.refund_status = this.__props__.refund_status;\n        this.refund_amount = this.__props__.refund_amount;\n        this.refund_time = this.__props__.refund_time;\n        this.audit_status = this.__props__.audit_status;\n        this.receiver_name = this.__props__.receiver_name;\n        this.receiver_mobile = this.__props__.receiver_mobile;\n        this.receiver_address = this.__props__.receiver_address;\n        this.items_snapshot = this.__props__.items_snapshot;\n        this.created_at = this.__props__.created_at;\n        this.pay_time = this.__props__.pay_time;\n        this.items = this.__props__.items;\n        delete this.__props__;\n    }\n}\nexport default defineComponent({\n    data() {\n        return {\n            statusBarHeight: 0,\n            tabIndex: 4,\n            keyword: '',\n            loading: false,\n            allOrders: [],\n            tabList: [\n                new UTSJSONObject({ status: 0, title: '待付款' }),\n                new UTSJSONObject({ status: 1, title: '已支付' }),\n                new UTSJSONObject({ status: 2, title: '退款中' }),\n                new UTSJSONObject({ status: 3, title: '已退款' }),\n                new UTSJSONObject({ status: -1, title: '全部' }),\n            ],\n        };\n    },\n    computed: {\n        // 根据 tab + 关键字 过滤后的订单列表\n        filteredOrders() {\n            let list = this.allOrders;\n            // 按状态过滤\n            const currentTab = this.tabList[this.tabIndex];\n            if (currentTab && currentTab.status !== -1) {\n                const s = currentTab.status;\n                list = list.filter((o) => { return o.status === s; });\n            }\n            // 按关键字过滤（订单号 / 姓名 / 手机）\n            const k = this.keyword.trim();\n            if (k.length > 0) {\n                list = list.filter((o) => {\n                    return ((o.order_no && o.order_no.indexOf(k) !== -1) ||\n                        (o.user_name && o.user_name.indexOf(k) !== -1) ||\n                        (o.mobile && o.mobile.indexOf(k) !== -1));\n                });\n            }\n            return list;\n        },\n    },\n    onLoad() {\n        const win = uni.getWindowInfo();\n        this.statusBarHeight = win.statusBarHeight;\n        this.fetchOrders();\n    },\n    methods: {\n        onBack() {\n            uni.navigateBack();\n        },\n        onSearch() {\n            // 本地过滤，什么都不用做，filteredOrders 会自动刷新\n        },\n        changeTab(index) {\n            if (this.tabIndex === index)\n                return null;\n            this.tabIndex = index;\n        },\n        // 获取当前用户所有订单，并解析 items_snapshot\n        fetchOrders() {\n            const openid = uni.getStorageSync('openid');\n            if (!openid) {\n                uni.showToast({\n                    title: '未获取到用户身份，请先登录',\n                    icon: 'none',\n                });\n                return null;\n            }\n            this.loading = true;\n            uni.request({\n                url: 'https://wdxwhdglzx.jzzw-tech.cn/api/order/list',\n                method: 'GET',\n                data: new UTSJSONObject({ openid }),\n                success: (res) => {\n                    const body = res.data;\n                    if (body && body.code === 200 && Array.isArray(body.data)) {\n                        const list = body.data;\n                        // 解析 items_snapshot\n                        this.allOrders = list.map((it = null) => {\n                            let items = [];\n                            if (it.items_snapshot) {\n                                try {\n                                    const tmp = UTS.JSON.parse(it.items_snapshot);\n                                    if (Array.isArray(tmp)) {\n                                        items = tmp;\n                                    }\n                                }\n                                catch (e) {\n                                    uni.__f__('log', 'at pages/OrderList/OrderList.uvue:300', '解析 items_snapshot 失败', e, it.items_snapshot);\n                                }\n                            }\n                            ;\n                            it.items = items;\n                            return it;\n                        });\n                    }\n                    else {\n                        this.allOrders = [];\n                        uni.showToast({\n                            title: '订单加载失败',\n                            icon: 'none',\n                        });\n                    }\n                },\n                fail: (err) => {\n                    uni.__f__('log', 'at pages/OrderList/OrderList.uvue:315', '订单请求失败', err);\n                    this.allOrders = [];\n                    uni.showToast({\n                        title: '网络错误',\n                        icon: 'none',\n                    });\n                },\n                complete: () => {\n                    this.loading = false;\n                },\n            });\n        },\n        // 金额格式化：保留两位小数\n        formatAmount(v = null) {\n            const n = Number(v || 0);\n            return n.toFixed(2);\n        },\n        // 状态文案\n        formatStatus(s) {\n            switch (s) {\n                case 0:\n                    return '待付款';\n                case 1:\n                    return '已支付';\n                case 2:\n                    return '退款中';\n                case 3:\n                    return '已退款';\n                default:\n                    return '未知';\n            }\n        },\n        // 时间格式化：展示时 +8 小时\n        formatTime(t = null) {\n            if (!t)\n                return '-';\n            const d = new Date(t);\n            d.setHours(d.getHours());\n            const year = d.getFullYear();\n            const month = (d.getMonth() + 1).toString().padStart(2, '0');\n            const day = d.getDate().toString().padStart(2, '0');\n            const hour = d.getHours().toString().padStart(2, '0');\n            const minute = d.getMinutes().toString().padStart(2, '0');\n            const second = d.getSeconds().toString().padStart(2, '0');\n            return `${year}-${month}-${day} ${hour}:${minute}:${second}`;\n        },\n        // 跳转订单详情\n        goDetail(id) {\n            uni.navigateTo({\n                url: `/pages/OrderDetails/OrderDetails?orderId=${id}`,\n            });\n        },\n    },\n});\n//# sourceMappingURL=C:/Users/zrh/Desktop/7600/e-shop/pages/OrderList/OrderList.uvue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.getWindowInfo","uni.navigateBack","uni.getStorageSync","uni.showToast","uni.__f__","uni.request","uni.navigateTo"],"map":"{\"version\":3,\"file\":\"OrderList.uvue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"OrderList.uvue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
