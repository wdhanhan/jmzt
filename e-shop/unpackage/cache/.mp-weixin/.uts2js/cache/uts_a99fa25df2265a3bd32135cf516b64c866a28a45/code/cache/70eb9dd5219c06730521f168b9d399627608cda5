{"code":"import { defineComponent } from \"vue\";\nconst API_BASE = 'https://jmzt.cxxyonline.cn';\nexport default defineComponent({\n    data() {\n        return {\n            statusBarHeight: 0,\n            orderId: 0,\n            order: new UTSJSONObject({}),\n            items: [], // items_snapshot 解析后的课程数组\n        };\n    },\n    computed: {\n        // 订单状态文案\n        statusText() {\n            const s = Number(this.order.status || 0);\n            switch (s) {\n                case 0: return '待支付';\n                case 1: return '已支付';\n                case 2: return '退款中';\n                case 3: return '已退款';\n                default: return '未知状态';\n            }\n        }\n    },\n    onLoad(options) {\n        const win = uni.getWindowInfo();\n        this.statusBarHeight = win.statusBarHeight || 0;\n        const idStr = (options && (options.orderId || options.id)) || '';\n        this.orderId = Number(idStr) || 0;\n        this.loadOrder();\n    },\n    methods: {\n        // 返回上一页\n        onBack() {\n            uni.navigateBack();\n        },\n        // 加载订单：通过 openid 拉取列表，再按 id 找到当前订单\n        loadOrder() {\n            const openid = uni.getStorageSync('openid');\n            if (!openid) {\n                uni.showToast({\n                    title: '未找到用户信息，请先登录',\n                    icon: 'none'\n                });\n                return null;\n            }\n            uni.request({\n                url: `${API_BASE}/api/order/list`,\n                method: 'GET',\n                data: new UTSJSONObject({ openid }),\n                success: (res) => {\n                    const body = res.data || {};\n                    if (body.code !== 200) {\n                        uni.showToast({\n                            title: body.msg || '订单加载失败',\n                            icon: 'none'\n                        });\n                        return null;\n                    }\n                    const list = body.data || [];\n                    const found = list.find((o = null) => { return Number(o.id) === this.orderId; });\n                    if (!found) {\n                        uni.showToast({\n                            title: '未找到该订单',\n                            icon: 'none'\n                        });\n                        return null;\n                    }\n                    this.order = found;\n                    this.parseItems(found.items_snapshot);\n                },\n                fail: () => {\n                    uni.showToast({\n                        title: '网络异常，请稍后重试',\n                        icon: 'none'\n                    });\n                }\n            });\n        },\n        // 解析 items_snapshot 里的课程信息\n        parseItems(snapshot = null) {\n            this.items = [];\n            if (!snapshot)\n                return null;\n            try {\n                const arr = UTS.JSON.parse(snapshot);\n                if (!Array.isArray(arr))\n                    return null;\n                this.items = arr.map((it = null) => { return (new UTSJSONObject({\n                    product_id: it.product_id,\n                    sku_id: it.sku_id,\n                    name: it.name || it.product_name || '课程',\n                    sku_name: it.sku_name || '',\n                    price: Number(it.price || 0),\n                    quantity: Number(it.quantity || 1),\n                    image: it.image || '',\n                    attr1: it.attr1 || '',\n                    attr2: it.attr2 || '',\n                    attr3: it.attr3 || '',\n                })); });\n            }\n            catch (e) {\n                uni.__f__('error', 'at pages/OrderDetails/OrderDetails.uvue:282', '解析 items_snapshot 出错：', e);\n            }\n        },\n        // 金额格式化：保留两位小数\n        formatAmount(v = null) {\n            const n = Number(v || 0);\n            return n.toFixed(2);\n        },\n        // 时间 +8 小时后展示\n        formatTimePlus8(t = null) {\n            if (!t)\n                return '—';\n            const d = new Date(t);\n            if (isNaN(d.getTime()))\n                return String(t);\n            const ts = d.getTime() + 8 * 60 * 60 * 1000;\n            const dd = new Date(ts);\n            const y = dd.getFullYear();\n            const m = (dd.getMonth() + 1).toString().padStart(2, '0');\n            const day = dd.getDate().toString().padStart(2, '0');\n            const hh = dd.getHours().toString().padStart(2, '0');\n            const mm = dd.getMinutes().toString().padStart(2, '0');\n            const ss = dd.getSeconds().toString().padStart(2, '0');\n            return `${y}-${m}-${day} ${hh}:${mm}:${ss}`;\n        }\n    }\n});\n//# sourceMappingURL=C:/Users/zrh/Desktop/7600/e-shop/pages/OrderDetails/OrderDetails.uvue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.getWindowInfo","uni.navigateBack","uni.getStorageSync","uni.showToast","uni.request","uni.__f__"],"map":"{\"version\":3,\"file\":\"OrderDetails.uvue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"OrderDetails.uvue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
