"use strict";const t=require("../../common/vendor.js"),e=require("../../mock/goodsData.js"),i=require("../../common/assets.js"),o=t.defineComponent({data:()=>({statusBarBottom:0,goodsId:0,info:new e.goodsItems({}),quantity:1,realName:"",mobile:"",idCardNo:"",submitting:!1}),computed:{currentSkuName(){const t=this.info.skus||[];return Array.isArray(t)&&t.length>0&&t[0].sku_name||""},goodsTotal(){return Number(this.info.price||0)*this.quantity},payAmount(){return this.goodsTotal}},onLoad(e){const i=t.index.getWindowInfo();this.statusBarBottom=i.safeAreaInsets.bottom;const o=e.get("goodsId");this.goodsId=o.toInt(),this.getData()},methods:{formatPrice(t){const e=Number(t||0).toFixed(2).split(".");return new UTSJSONObject({int:e[0],dec:e[1]||"00"})},changeQty(t){let e=this.quantity+t;e<1&&(e=1),this.quantity=e},getData(){t.index.request({url:`http://211.159.180.202:8088/api/products/${this.goodsId}`,method:"GET",success:(t=null)=>{var i;const o=(null===(i=t.data)||void 0===i?null:i.data)||new UTSJSONObject({}),s=Array.isArray(o.images)&&o.images.length>0&&o.images[0]||o.pic||"";let n=0;n=Array.isArray(o.skus)&&o.skus.length>0?Number(o.skus[0].price||0):Number(o.price||o.min_price||0),this.info=new e.goodsItems(Object.assign(Object.assign({},o),{pic:s,price:n}))},fail:e=>{console.error("加载商品失败",e),t.index.showToast({title:"加载商品失败",icon:"none"})}})},onSubmit(){if(this.submitting)return null;if(!this.realName)return t.index.showToast({title:"请输入姓名",icon:"none"}),null;if(!this.mobile)return t.index.showToast({title:"请输入手机号",icon:"none"}),null;if(!this.idCardNo)return t.index.showToast({title:"请输入身份证号",icon:"none"}),null;const e=new UTSJSONObject({product_id:this.info.id,product_name:this.info.name,sku_id:this.info.sku_id||0,sku_name:this.currentSkuName||"",price:Number(this.info.price||0),quantity:this.quantity,image:this.info.pic}),i=new UTSJSONObject({userId:0,realName:this.realName,mobile:this.mobile,idCardNo:this.idCardNo,items:[e]});this.submitting=!0,t.index.request({url:"http://211.159.180.202:8088/api/orders/create",method:"POST",data:i,success:(e=null)=>{const i=e.data;200===i.code?(t.index.showToast({title:"提交成功",icon:"success"}),setTimeout((()=>{t.index.navigateTo({url:"/pages/OrderList/OrderList"})}),500)):t.index.showToast({title:i.message||"提交失败",icon:"none"})},fail:e=>{console.error("创建订单失败",e),t.index.showToast({title:"网络错误，稍后重试",icon:"none"})},complete:()=>{this.submitting=!1}})}}});const s=t._export_sfc(o,[["render",function(e,o,s,n,r,a){return{a:r.realName,b:t.o((t=>r.realName=t.detail.value)),c:r.mobile,d:t.o((t=>r.mobile=t.detail.value)),e:r.idCardNo,f:t.o((t=>r.idCardNo=t.detail.value)),g:i._imports_0$1,h:t.t(r.info.shopName||"商家"),i:r.info.pic,j:t.t(r.info.name),k:t.t(a.currentSkuName||"默认规格"),l:t.t(a.formatPrice(r.info.price).int),m:t.t(a.formatPrice(r.info.price).dec),n:t.o((t=>a.changeQty(-1))),o:t.t(r.quantity),p:t.o((t=>a.changeQty(1))),q:t.t(a.formatPrice(a.goodsTotal).int),r:t.t(a.formatPrice(a.goodsTotal).dec),s:t.t(a.formatPrice(a.payAmount).int),t:t.t(a.formatPrice(a.payAmount).dec),v:t.t(a.formatPrice(a.payAmount).int),w:t.t(a.formatPrice(a.payAmount).dec),x:t.t(r.submitting?"提交中...":"提交订单"),y:t.o(((...t)=>a.onSubmit&&a.onSubmit(...t))),z:r.statusBarBottom+"px",A:t.sei(t.gei(e,""),"view"),B:r.statusBarBottom+50+"px"}}]]);wx.createPage(s);
