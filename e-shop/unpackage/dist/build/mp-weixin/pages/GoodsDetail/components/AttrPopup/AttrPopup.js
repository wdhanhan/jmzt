"use strict";const t=require("../../../../common/vendor.js"),e=require("../../../../common/assets.js"),s=t.defineComponent({components:{CatPopup:()=>"../../../../components/CatPopup/CatPopup.js"},props:{info:{type:Object,default:()=>new UTSJSONObject({id:0,name:"",price:0,pic:"",images:[],skus:[]})}},data:()=>({statusBarBottom:0,btnType:"",selectedSkuIndex:0,quantity:1}),mounted(){const e=t.index.getWindowInfo();this.statusBarBottom=e.safeAreaInsets?e.safeAreaInsets.bottom:0,this.info&&this.info.skus&&this.info.skus.length>0&&(this.selectedSkuIndex=0)},computed:{currentSku(){return this.info&&this.info.skus&&this.info.skus.length>0&&this.info.skus[this.selectedSkuIndex]||new UTSJSONObject({})},displayPic(){return this.currentSku&&this.currentSku.image?this.currentSku.image:this.info&&this.info.images&&this.info.images.length>0?this.info.images[0]:this.info.pic||""},displayPrice(){return this.currentSku&&this.currentSku.price?this.currentSku.price:this.info.price||0},selectedSkuText(){if(!this.info.skus||0===this.info.skus.length)return"默认规格";const t=this.currentSku;return t&&t.sku_name||"默认规格"}},methods:{open(t=null){this.btnType=t||"buy",this.info.skus&&0!==this.info.skus.length?this.selectedSkuIndex>=this.info.skus.length&&(this.selectedSkuIndex=0):this.selectedSkuIndex=0,this.quantity=1,this.$refs.CatPopup&&this.$refs.CatPopup.$callMethod?this.$refs.CatPopup.$callMethod("open"):console.warn("CatPopup 实例上没有 $callMethod('open')")},close(){this.$refs.CatPopup&&this.$refs.CatPopup.$callMethod&&this.$refs.CatPopup.$callMethod("close")},selectSku(t=null){this.selectedSkuIndex=t},changeQty(t=null){const e=this.quantity+t;if(e<1)return null;this.quantity=e},onAddCart(){if(!this.currentSku||!this.currentSku.sku_id)return t.index.showToast({title:"请选择规格",icon:"none"}),null;t.index.showToast({title:"已加入购物车",icon:"success"}),this.close()},onBuy(){if(!this.currentSku||!this.currentSku.sku_id)return t.index.showToast({title:"请选择规格",icon:"none"}),null;const e=this.info.id||0,s=this.currentSku.sku_id,i=this.quantity;t.index.navigateTo({url:`/pages/ConfirmOrder/ConfirmOrder?goodsId=${e}&skuId=${s}&qty=${i}`})}}});if(!Array){t.resolveComponent("cat-popup")()}const i=t._export_sfc(s,[["render",function(s,i,n,o,u,r){return t.e({a:e._imports_0$11,b:t.o(((...t)=>r.close&&r.close(...t))),c:r.displayPic,d:t.t(n.info.name),e:t.t(r.selectedSkuText),f:t.t(r.displayPrice),g:t.f(n.info.skus,((e,s,i)=>t.e({a:e.image||n.info.pic||n.info.images&&n.info.images.length},e.image||n.info.pic||n.info.images&&n.info.images.length?{b:e.image||n.info.pic||n.info.images[0]}:{},{c:t.t(e.sku_name||"规格 "+(s+1)),d:t.t(e.price||n.info.price||0),e:void 0!==e.stock},void 0!==e.stock?{f:t.t(e.stock)}:{},{g:e.sku_id||s,h:s===u.selectedSkuIndex?1:"",i:t.o((t=>r.selectSku(s)),e.sku_id||s)}))),h:!n.info.skus||0===n.info.skus.length},(n.info.skus&&n.info.skus.length,{}),{i:e._imports_1$14,j:t.o((t=>r.changeQty(-1))),k:t.t(u.quantity),l:e._imports_2$8,m:t.o((t=>r.changeQty(1))),n:"cart"===u.btnType},"cart"===u.btnType?{o:t.o(((...t)=>r.onAddCart&&r.onAddCart(...t)))}:{},{p:"buy"===u.btnType},"buy"===u.btnType?{q:t.o(((...t)=>r.onBuy&&r.onBuy(...t)))}:{},{r:u.statusBarBottom+20+"px",s:t.sr("CatPopup","fa66e77a-0"),t:t.gei(s,""),v:t.p({mode:"bottom",id:t.gei(s,"")})})}]]);wx.createComponent(i);
