{"version":3,"file":"OrderDetails.js","sources":["pages/OrderDetails/OrderDetails.uvue","../../../Downloads/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvT3JkZXJEZXRhaWxzL09yZGVyRGV0YWlscy51dnVl"],"sourcesContent":["<template>\n  <!-- 整页滚动 -->\n  <scroll-view\n    class=\"page\"\n    scroll-y=\"true\"\n    :style=\"{ paddingTop: statusBarHeight + 'px' }\"\n  >\n    <!-- 顶部头部栏 -->\n    <view class=\"header\">\n      <view class=\"back\" @click=\"onBack\">\n        <image class=\"back-icon\" src=\"/static/images/icon/back_icon.png\"></image>\n      </view>\n      <text class=\"title\">订单详情</text>\n    </view>\n\n    <!-- 如果没有订单（比如 id 不存在） -->\n    <view v-if=\"!order || !order.id\" class=\"empty\">\n      <text class=\"empty-text\">未找到相关订单，请返回重试</text>\n    </view>\n\n    <!-- 有订单时显示内容 -->\n    <view v-else class=\"content\">\n\n      <!-- 状态 & 金额卡片 -->\n      <view class=\"card status-card\">\n        <view class=\"status-line\">\n          <text class=\"status-tag\" :class=\"'status-' + Number(order.status || 0)\">\n            {{ statusText }}\n          </text>\n        </view>\n        <view class=\"amount-line\">\n          <text class=\"label\">实付金额</text>\n          <view class=\"amount\">\n            <text class=\"amount-min\">￥</text>\n            <text class=\"amount-max\">{{ formatAmount(order.pay_amount) }}</text>\n          </view>\n        </view>\n        <view class=\"time-line\">\n          <text class=\"time-text\">\n            下单时间：{{ formatTimePlus8(order.created_at) }}\n          </text>\n        </view>\n        <view class=\"time-line\">\n          <text class=\"time-text\">\n            支付时间：{{ formatTimePlus8(order.pay_time) }}\n          </text>\n        </view>\n      </view>\n\n      <!-- 报名 / 学生信息 -->\n      <view class=\"card section-card\">\n        <view class=\"section-title\">\n          <text class=\"section-title-text\">报名信息</text>\n        </view>\n        <view class=\"row\">\n          <text class=\"row-label\">学生姓名</text>\n          <text class=\"row-value\">{{ order.user_name || '—' }}</text>\n        </view>\n        <view class=\"row\">\n          <text class=\"row-label\">身份证号</text>\n          <text class=\"row-value\">{{ order.id_card_no || '—' }}</text>\n        </view>\n        <view class=\"row\">\n          <text class=\"row-label\">手机号</text>\n          <text class=\"row-value\">{{ order.mobile || '—' }}</text>\n        </view>\n        <view class=\"row\">\n          <text class=\"row-label\">就读学校</text>\n          <text class=\"row-value\">{{ order.student_school || '—' }}</text>\n        </view>\n        <view class=\"row\">\n          <text class=\"row-label\">就读年级</text>\n          <text class=\"row-value\">{{ order.student_grade || '—' }}</text>\n        </view>\n      </view>\n\n      <!-- 课程信息（来自 items_snapshot） -->\n      <view class=\"card section-card\">\n        <view class=\"section-title\">\n          <text class=\"section-title-text\">课程信息</text>\n        </view>\n\n        <template v-if=\"items && items.length\">\n          <view\n            v-for=\"(it, idx) in items\"\n            :key=\"idx\"\n            class=\"course-item\"\n          >\n            <view class=\"course-pic\">\n              <image\n                v-if=\"it.image\"\n                :src=\"it.image\"\n                class=\"course-image\"\n                mode=\"aspectFill\"\n              ></image>\n              <view v-else class=\"course-noimg\">\n                <text class=\"course-noimg-text\">无图</text>\n              </view>\n            </view>\n\n            <view class=\"course-info\">\n              <view class=\"course-name\">\n                <text class=\"course-name-main\">\n                  {{ it.name }}\n                </text>\n              </view>\n\n              <view v-if=\"it.sku_name\" class=\"course-subline\">\n                <text class=\"course-sub-text\">{{ it.sku_name }}</text>\n              </view>\n\n              <view v-if=\"it.attr1 || it.attr2 || it.attr3\" class=\"course-attrs\">\n                <text v-if=\"it.attr1\" class=\"course-attr-text\">{{ it.attr1 }}</text>\n                <text v-if=\"it.attr2\" class=\"course-attr-text\">{{ it.attr2 }}</text>\n                <text v-if=\"it.attr3\" class=\"course-attr-text\">{{ it.attr3 }}</text>\n              </view>\n\n              <view class=\"course-bottom\">\n                <view class=\"course-price\">\n                  <text class=\"course-price-min\">￥</text>\n                  <text class=\"course-price-max\">{{ formatAmount(it.price) }}</text>\n                  <text class=\"course-num\">x{{ it.quantity || 1 }}</text>\n                </view>\n              </view>\n            </view>\n          </view>\n        </template>\n\n        <view v-else class=\"no-items\">\n          <text class=\"no-items-text\">暂无课程信息</text>\n        </view>\n      </view>\n\n      <!-- 订单信息 -->\n      <view class=\"card section-card\">\n        <view class=\"section-title\">\n          <text class=\"section-title-text\">订单信息</text>\n        </view>\n        <view class=\"row\">\n          <text class=\"row-label\">订单号</text>\n          <text class=\"row-value\">{{ order.order_no || order.id }}</text>\n        </view>\n        <view class=\"row\">\n          <text class=\"row-label\">下单时间</text>\n          <text class=\"row-value\">{{ formatTimePlus8(order.created_at) }}</text>\n        </view>\n        <view class=\"row\">\n          <text class=\"row-label\">支付时间</text>\n          <text class=\"row-value\">{{ formatTimePlus8(order.pay_time) }}</text>\n        </view>\n        <view class=\"row\">\n          <text class=\"row-label\">订单状态</text>\n          <text class=\"row-value\">{{ statusText }}</text>\n        </view>\n        <view class=\"row\">\n          <text class=\"row-label\">支付方式</text>\n          <text class=\"row-value\">微信支付</text>\n        </view>\n      </view>\n\n      <!-- 页底空隙 -->\n      <view style=\"height: 60rpx;\"></view>\n    </view>\n  </scroll-view>\n</template>\n\n<script lang=\"uts\">\nconst API_BASE = 'https://wdxwhdglzx.jzzw-tech.cn';\n\nexport default {\n  data() {\n    return {\n      statusBarHeight: 0,\n\n      orderId: 0,    // 路由传入的订单 id\n      order: {},     // 当前订单\n      items: [],     // items_snapshot 解析后的课程数组\n    };\n  },\n\n  computed: {\n    // 订单状态文案\n    statusText() {\n      const s = Number(this.order.status || 0);\n      switch (s) {\n        case 0: return '待支付';\n        case 1: return '已支付';\n        case 2: return '退款中';\n        case 3: return '已退款';\n        default: return '未知状态';\n      }\n    }\n  },\n\n  onLoad(options) {\n    const win = uni.getWindowInfo();\n    this.statusBarHeight = win.statusBarHeight || 0;\n\n    const idStr = (options && (options.orderId || options.id)) || '';\n    this.orderId = Number(idStr) || 0;\n\n    this.loadOrder();\n  },\n\n  methods: {\n    // 返回上一页\n    onBack() {\n      uni.navigateBack();\n    },\n\n    // 加载订单：通过 openid 拉取列表，再按 id 找到当前订单\n    loadOrder() {\n      const openid = uni.getStorageSync('openid');\n      if (!openid) {\n        uni.showToast({\n          title: '未找到用户信息，请先登录',\n          icon: 'none'\n        });\n        return;\n      }\n\n      uni.request({\n        url: `${API_BASE}/api/order/list`,\n        method: 'GET',\n        data: { openid },\n        success: (res) => {\n          const body = res.data || {};\n          if (body.code !== 200) {\n            uni.showToast({\n              title: body.msg || '订单加载失败',\n              icon: 'none'\n            });\n            return;\n          }\n\n          const list = body.data || [];\n          const found = list.find(o => Number(o.id) === this.orderId);\n\n          if (!found) {\n            uni.showToast({\n              title: '未找到该订单',\n              icon: 'none'\n            });\n            return;\n          }\n\n          this.order = found;\n          this.parseItems(found.items_snapshot);\n        },\n        fail: () => {\n          uni.showToast({\n            title: '网络异常，请稍后重试',\n            icon: 'none'\n          });\n        }\n      });\n    },\n\n    // 解析 items_snapshot 里的课程信息\n    parseItems(snapshot) {\n      this.items = [];\n\n      if (!snapshot) return;\n\n      try {\n        const arr = JSON.parse(snapshot);\n        if (!Array.isArray(arr)) return;\n\n        this.items = arr.map(it => ({\n          product_id: it.product_id,\n          sku_id: it.sku_id,\n          name: it.name || it.product_name || '课程',\n          sku_name: it.sku_name || '',\n          price: Number(it.price || 0),\n          quantity: Number(it.quantity || 1),\n          image: it.image || '',\n          attr1: it.attr1 || '',\n          attr2: it.attr2 || '',\n          attr3: it.attr3 || '',\n        }));\n      } catch (e) {\n        uni.__f__('error','at pages/OrderDetails/OrderDetails.uvue:282','解析 items_snapshot 出错：', e);\n      }\n    },\n\n    // 金额格式化：保留两位小数\n    formatAmount(v) {\n      const n = Number(v || 0);\n      return n.toFixed(2);\n    },\n\n    // 时间 +8 小时后展示\n    formatTimePlus8(t) {\n      if (!t) return '—';\n      const d = new Date(t);\n      if (isNaN(d.getTime())) return String(t);\n\n      const ts = d.getTime() + 8 * 60 * 60 * 1000;\n      const dd = new Date(ts);\n\n      const y = dd.getFullYear();\n      const m = (dd.getMonth() + 1).toString().padStart(2, '0');\n      const day = dd.getDate().toString().padStart(2, '0');\n      const hh = dd.getHours().toString().padStart(2, '0');\n      const mm = dd.getMinutes().toString().padStart(2, '0');\n      const ss = dd.getSeconds().toString().padStart(2, '0');\n      return `${y}-${m}-${day} ${hh}:${mm}:${ss}`;\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\">\n.page {\n  background-color: #f5f5f5;\n  min-height: 100vh;\n  box-sizing: border-box;\n}\n\n/* 头部 */\n.header {\n  height: 88rpx;\n  background-color: #ffffff;\n  padding: 0 24rpx;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.05);\n  margin-bottom: 20rpx;\n}\n\n.back {\n  width: 80rpx;\n  height: 88rpx;\n  display: flex;\n  align-items: center;\n}\n\n.back-icon {\n  width: 40rpx;\n  height: 40rpx;\n}\n\n.title {\n  font-size: 32rpx;\n  font-weight: 600;\n  color: #111827;\n}\n\n/* 内容容器 */\n.content {\n  padding: 0 24rpx 24rpx 24rpx;\n}\n\n/* 卡片通用样式 */\n.card {\n  background-color: #ffffff;\n  border-radius: 16rpx;\n  padding: 20rpx 24rpx;\n  margin-bottom: 20rpx;\n}\n\n/* 状态 / 金额卡片 */\n.status-card .status-line {\n  margin-bottom: 12rpx;\n}\n\n.status-tag {\n  padding: 4rpx 16rpx;\n  border-radius: 999rpx;\n  font-size: 24rpx;\n}\n\n/* 不同状态颜色 */\n.status-0 {\n  background-color: #fef3c7;\n  color: #92400e;\n}\n.status-1 {\n  background-color: #dcfce7;\n  color: #166534;\n}\n.status-2 {\n  background-color: #e0f2fe;\n  color: #075985;\n}\n.status-3 {\n  background-color: #fee2e2;\n  color: #991b1b;\n}\n\n.amount-line {\n  display: flex;\n  flex-direction: row;\n  align-items: flex-end;\n  margin-top: 4rpx;\n  margin-bottom: 12rpx;\n}\n\n.amount-line .label {\n  font-size: 26rpx;\n  color: #6b7280;\n  margin-right: 12rpx;\n}\n\n.amount {\n  flex-direction: row;\n  align-items: flex-end;\n}\n\n.amount-min {\n  font-size: 24rpx;\n  color: #111827;\n}\n\n.amount-max {\n  font-size: 40rpx;\n  font-weight: 600;\n  color: #111827;\n}\n\n.time-line {\n  margin-top: 4rpx;\n}\n\n.time-text {\n  font-size: 24rpx;\n  color: #6b7280;\n}\n\n/* 通用分块卡片 */\n.section-card .section-title {\n  margin-bottom: 12rpx;\n}\n\n.section-title-text {\n  font-size: 28rpx;\n  font-weight: 600;\n  color: #111827;\n}\n\n/* 行 */\n.row {\n  display: flex;\n  flex-direction: row;\n  padding: 8rpx 0;\n}\n\n.row-label {\n  width: 160rpx;\n  font-size: 26rpx;\n  color: #6b7280;\n}\n\n.row-value {\n  flex: 1;\n  font-size: 26rpx;\n  color: #111827;\n}\n\n/* 课程项 */\n.course-item {\n  display: flex;\n  flex-direction: row;\n  padding: 14rpx 0;\n  border-top-width: 1rpx;\n  border-top-style: solid;\n  border-top-color: #f1f5f9;\n}\n\n.course-item:first-of-type {\n  border-top-width: 0;\n}\n\n.course-pic {\n  width: 160rpx;\n  height: 160rpx;\n  margin-right: 16rpx;\n}\n\n.course-image {\n  width: 100%;\n  height: 100%;\n  border-radius: 12rpx;\n}\n\n.course-noimg {\n  width: 100%;\n  height: 100%;\n  border-radius: 12rpx;\n  background-color: #f3f4f6;\n  align-items: center;\n  justify-content: center;\n  display: flex;\n}\n\n.course-noimg-text {\n  font-size: 24rpx;\n  color: #9ca3af;\n}\n\n.course-info {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n}\n\n.course-name-main {\n  font-size: 28rpx;\n  font-weight: 500;\n  color: #111827;\n}\n\n.course-subline {\n  margin-top: 4rpx;\n}\n\n.course-sub-text {\n  font-size: 24rpx;\n  color: #6b7280;\n}\n\n.course-attrs {\n  margin-top: 4rpx;\n}\n\n.course-attr-text {\n  font-size: 22rpx;\n  color: #6b7280;\n  margin-right: 8rpx;\n}\n\n.course-bottom {\n  margin-top: 10rpx;\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  align-items: flex-end;\n}\n\n.course-price {\n  flex-direction: row;\n  align-items: flex-end;\n}\n\n.course-price-min {\n  font-size: 24rpx;\n  color: #ef4444;\n}\n\n.course-price-max {\n  font-size: 32rpx;\n  font-weight: 600;\n  color: #ef4444;\n}\n\n.course-num {\n  font-size: 24rpx;\n  color: #6b7280;\n  margin-left: 8rpx;\n}\n\n/* 空状态 */\n.empty {\n  padding: 120rpx 40rpx;\n  align-items: center;\n  justify-content: center;\n}\n\n.empty-text {\n  font-size: 28rpx;\n  color: #9ca3af;\n}\n</style>\n","import MiniProgramPage from 'C:/Users/若涵/Desktop/接单/e-shop/pages/OrderDetails/OrderDetails.uvue'\nwx.createPage(MiniProgramPage)"],"names":["defineComponent","uni"],"mappings":"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"}