{"version":3,"file":"home.js","sources":["pages/home/home.uvue","../../../Downloads/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaG9tZS9ob21lLnV2dWU"],"sourcesContent":["<template>\r\n\r\n\r\n\r\n\r\n    <!-- 搜索 -->\r\n    <view\r\n      class=\"head-search\"\r\n      :style=\"{ height: (statusBarHeight + 50) + 'px', paddingTop: statusBarHeight + 'px' }\"\r\n    >\r\n      <view class=\"search-info\" @click=\"onSearch\">\r\n        <image src=\"//static/images/icon/fdj_icon.png\" class=\"image\"></image>\r\n        <text class=\"text\">请输入搜索内容</text>\r\n      </view>\r\n      <view class=\"scan-icon\">\r\n        <image src=\"/static/images/icon/sm_icon.png\" class=\"image\"></image>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- Banner（从接口加载） -->\r\n    <view class=\"banner-info\" :style=\"{ marginTop: (statusBarHeight + 60) + 'px' }\">\r\n      <swiper\r\n        class=\"swiper\"\r\n        :autoplay=\"true\"\r\n        :circular=\"true\"\r\n        :indicator-dots=\"false\"\r\n        @change=\"changeBanner\"\r\n      >\r\n        <swiper-item v-for=\"(item, index) in bannerList\" :key=\"index\">\r\n          <image\r\n            :src=\"item.pic\"\r\n            mode=\"aspectFill\"\r\n            class=\"image\"\r\n            @click=\"onBannerClick(item)\"\r\n          ></image>\r\n        </swiper-item>\r\n      </swiper>\r\n\r\n      <view class=\"indicator-dot\">\r\n        <view\r\n          class=\"dots\"\r\n          v-for=\"(item, index) in bannerList\"\r\n          :key=\"index\"\r\n          :class=\"{ 'active': bannerCurrent === index }\"\r\n        >\r\n          <text style=\"display:none\">{{ item }}</text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 猜你喜欢 / 课程安排 -->\r\n    <view class=\"guess-like\">\r\n      <view class=\"title-info\">\r\n        <view class=\"title\">\r\n          <view class=\"line\"></view>\r\n          <text class=\"tit\">课程安排</text>\r\n        </view>\r\n      </view>\r\n\r\n      <view class=\"goods-list\">\r\n        <view\r\n          class=\"list\"\r\n          v-for=\"(item, index) in goodsList\"\r\n          :key=\"index\"\r\n          @click=\"onGoodsItem(item)\"\r\n        >\r\n          <view class=\"pic\">\r\n            <image :src=\"item.pic\" class=\"image\"></image>\r\n          </view>\r\n          <view class=\"title\">\r\n            <text class=\"text\">{{ item.name }}</text>\r\n          </view>\r\n          <view class=\"price\">\r\n            <text class=\"min\">￥</text>\r\n            <text class=\"max\">{{ formatPrice(item.price, 0) }}</text>\r\n            <text class=\"min\" v-if=\"formatPrice(item.price, 1)\">\r\n              .{{ formatPrice(item.price, 1) }}\r\n            </text>\r\n          </view>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n\r\n\r\n\r\n</template>\r\n\r\n<script lang=\"uts\">\r\nexport default {\r\n  data() {\r\n    return {\r\n      statusBarHeight: 0,\r\n      bannerCurrent: 0,\r\n\r\n      // ⭐ 轮播图从接口加载\r\n      bannerList: [],\r\n\r\n      // 首页商品列表\r\n      goodsList: [],\r\n    };\r\n  },\r\n\r\n  onLoad() {\r\n    this.statusBarHeight = uni.getWindowInfo().statusBarHeight;\r\n\r\n    // 加载轮播图 + 商品\r\n    this.loadBanners();\r\n    this.loadGoods();\r\n\t uni.showShareMenu({\r\n\t      withShareTicket: true,\r\n\t      menus: ['shareAppMessage', 'shareTimeline'],\r\n\t      success: () => {\r\n\t        uni.__f__('log','at pages/home/home.uvue:114','已打开分享菜单')\r\n\t      },\r\n\t      fail: (err) => {\r\n\t        uni.__f__('log','at pages/home/home.uvue:117','showShareMenu 失败：', err)\r\n\t      }\r\n\t    })\r\n  },\r\n\r\n  methods: {\r\n\t    // 分享给好友\r\n\t    onShareAppMessage() {\r\n\t      return {\r\n\t        title: '武汉东西湖青少年活动中心',         // 分享标题\r\n\t        path: '/pages/home/home',                // 打开的路径\r\n\t        // imageUrl 可选，不写就用默认截图\r\n\t        // imageUrl: 'https://xxx/your-share-img.png'\r\n\t      }\r\n\t    },\r\n\t  \r\n\t    // 分享到朋友圈\r\n\t    onShareTimeline() {\r\n\t      return {\r\n\t        title: '武汉东西湖青少年活动中心',   // 朋友圈标题\r\n\t        // query 可选：'?from=timeline'\r\n\t        // imageUrl: 'https://xxx/your-share-img.png'\r\n\t      }\r\n\t    },\r\n\t  \r\n\t  \r\n    // 格式化价格\r\n    formatPrice(price, type) {\r\n      if (!price) return type ? '' : '0';\r\n      let str = price.toString();\r\n      let [i, d] = str.split('.');\r\n      return type === 0 ? i : (d || '');\r\n    },\r\n\r\n    changeBanner(e) {\r\n      this.bannerCurrent = e.detail.current;\r\n    },\r\n\r\n    onSearch() {\r\n      uni.navigateTo({ url: '/pages/search/search' });\r\n    },\r\n\r\n    // 点击 Banner -> 跳商品详情（用 product_id）\r\n    onBannerClick(item) {\r\n      if (!item.product_id) return;\r\n      uni.navigateTo({\r\n        url: `/pages/GoodsDetail/GoodsDetail?goodsId=${item.product_id}`,\r\n      });\r\n    },\r\n\r\n    onGoodsItem(item) {\r\n      uni.navigateTo({\r\n        url: `/pages/GoodsDetail/GoodsDetail?goodsId=${item.id}`,\r\n      });\r\n    },\r\n\r\n    // ⭐ 加载轮播图（后端 carousel 表）\r\n    async loadBanners() {\r\n      try {\r\n        const res = await uni.request({\r\n          url: 'https://wdxwhdglzx.jzzw-tech.cn/api/carousel/list',\r\n          method: 'GET',\r\n        });\r\n\r\n        const body = res.data || {};\r\n        if (body.code === 200 && Array.isArray(body.data)) {\r\n          // 后端返回：[{ id, image_url, product_id }]\r\n          this.bannerList = body.data.map(b => ({\r\n            id: b.id,\r\n            pic: b.image_url,\r\n            product_id: b.product_id,\r\n          }));\r\n        } else {\r\n          uni.__f__('error','at pages/home/home.uvue:190','加载轮播图失败:', body);\r\n        }\r\n      } catch (e) {\r\n        uni.__f__('error','at pages/home/home.uvue:193','加载轮播图异常:', e);\r\n      }\r\n    },\r\n\r\n    // ⭐ 加载首页商品\r\n    async loadGoods() {\r\n      try {\r\n        const res = await uni.request({\r\n          url: 'https://wdxwhdglzx.jzzw-tech.cn/api/products/home',\r\n          method: 'GET',\r\n        });\r\n\r\n        const body = res.data || {};\r\n        const list = (body.data && body.data.list) || [];\r\n\r\n        this.goodsList = list.map(g => ({\r\n          id: g.id,\r\n          name: g.name,\r\n          // 兼容后端字段：min_price / price\r\n          price: g.min_price || g.price || 0,\r\n          pic: g.pic || '',\r\n        }));\r\n      } catch (e) {\r\n        uni.__f__('error','at pages/home/home.uvue:216','加载商品失败', e);\r\n      }\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n@import \"home.scss\";\r\n</style>\r\n","import MiniProgramPage from 'C:/Users/若涵/Desktop/接单/e-shop/pages/home/home.uvue'\nwx.createPage(MiniProgramPage)"],"names":["defineComponent","uni","__read"],"mappings":"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"}