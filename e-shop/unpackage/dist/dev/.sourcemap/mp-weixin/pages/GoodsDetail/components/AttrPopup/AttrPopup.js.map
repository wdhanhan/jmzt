{"version":3,"file":"AttrPopup.js","sources":["pages/GoodsDetail/components/AttrPopup/AttrPopup.uvue","../../HBuilderX/plugins/uniapp-cli-vite/uniComponent:/QzovVXNlcnMvenJoL0Rlc2t0b3AvNzYwMC9lLXNob3AvcGFnZXMvR29vZHNEZXRhaWwvY29tcG9uZW50cy9BdHRyUG9wdXAvQXR0clBvcHVwLnV2dWU"],"sourcesContent":["<template>\n  <cat-popup ref=\"CatPopup\" mode=\"bottom\">\n    <view class=\"attr-info\" :style=\"{ paddingBottom: (statusBarBottom + 20) + 'px' }\">\n      <!-- ÂÖ≥Èó≠ÊåâÈíÆ -->\n      <view class=\"close\" @click=\"close\">\n        <image src=\"/static/images/icon/close_icon.png\" class=\"image\"></image>\n      </view>\n\n      <!-- È°∂ÈÉ®ÂïÜÂìÅ + ÂΩìÂâçÈÄâ‰∏≠ÁöÑ SKU -->\n      <view class=\"goods-data\">\n        <view class=\"pic\">\n          <image :src=\"displayPic\" class=\"image\"></image>\n        </view>\n        <view class=\"data\">\n          <view class=\"title\">\n            <text class=\"text\">{{ info.name }}</text>\n          </view>\n          <view class=\"attr\">\n            <text class=\"text\">Â∑≤ÈÄâÔºö</text>\n            <text class=\"text\">{{ selectedSkuText }}</text>\n          </view>\n          <view class=\"price\">\n            <view class=\"selling-price\">\n              <text class=\"min\">Ôø•</text>\n              <text class=\"max\">{{ displayPrice }}</text>\n            </view>\n          </view>\n        </view>\n      </view>\n\n      <!-- üëá ËøôÈáåÊîπÊàêÔºö‰∏ÄÊù° SKU ‰∏ÄÊù°ËÆ∞ÂΩïÔºà‰∏çÊãÜÂàÜÁ±ªÔºâ -->\n      <scroll-view class=\"attr-select\">\n        <view\n          class=\"sku-item\"\n          v-for=\"(sku, index) in info.skus\"\n          :key=\"sku.sku_id || index\"\n          :class=\"{ active: index === selectedSkuIndex }\"\n          @click=\"selectSku(index)\"\n        >\n          <view class=\"sku-left\">\n            <image\n              v-if=\"sku.image || info.pic || (info.images && info.images.length)\"\n              :src=\"sku.image || info.pic || info.images[0]\"\n              class=\"sku-image\"\n            ></image>\n          </view>\n\n          <view class=\"sku-right\">\n            <view class=\"sku-name\">\n<text class=\"text\">\n  {{ formatSkuName(sku, index) }}\n</text>\n            </view>\n\n            <view class=\"sku-price-stock\">\n              <text class=\"price\">Ôø•{{ sku.price || info.price || 0 }}</text>\n              <text class=\"stock\" v-if=\"sku.stock !== undefined\">\n                Â∫ìÂ≠òÔºö{{ sku.stock }}\n              </text>\n            </view>\n          </view>\n        </view>\n\n        <!-- Ê≤°Êúâ SKU ÁöÑÂÖúÂ∫ï -->\n        <view v-if=\"!info.skus || info.skus.length === 0\" class=\"empty-sku\">\n          <text class=\"text\">ÊöÇÊó†ÂèØÈÄâËßÑÊ†º</text>\n        </view>\n      </scroll-view>\n\n      <!-- Êï∞Èáè -->\n      <view class=\"goods-number\">\n        <view class=\"title\">\n          <text class=\"text\">Êï∞Èáè</text>\n        </view>\n        <view class=\"number\">\n          <view class=\"sub\" @click=\"changeQty(-1)\">\n            <image src=\"/static/images/icon/sub_icon2.png\" class=\"image\"></image>\n          </view>\n          <view class=\"num\">\n            <text class=\"text\">{{ quantity }}</text>\n          </view>\n          <view class=\"add\" @click=\"changeQty(1)\">\n            <image src=\"/static/images/icon/add_icon2.png\" class=\"image\"></image>\n          </view>\n        </view>\n      </view>\n\n      <!-- Â∫ïÈÉ®ÊåâÈíÆ -->\n      <view class=\"attr-btn\">\n        <view class=\"btn\" v-if=\"btnType === 'cart'\" @click=\"onAddCart\">\n          <text class=\"text\">Âä†ÂÖ•Ë¥≠Áâ©ËΩ¶</text>\n        </view>\n        <view class=\"btn\" v-if=\"btnType === 'buy'\" @click=\"onBuy\">\n          <text class=\"text\">Á´ãÂç≥Ë¥≠‰π∞</text>\n        </view>\n      </view>\n    </view>\n  </cat-popup>\n</template>\n\n<script lang=\"uts\">\nimport CatPopup from \"@/components/CatPopup/CatPopup.uvue\";\n\nconst API_BASE = \"https://wdxwhdglzx.jzzw-tech.cn\";\n\nexport default {\n  components: {\n    CatPopup,\n  },\n\n  props: {\n    // Áõ¥Êé•Áî®ÂêéÁ´Ø /api/products/:id ËøîÂõûÁöÑ data\n    info: {\n      type: Object,\n      default() {\n        return {\n          id: 0,\n          name: \"\",\n          price: 0,\n          pic: \"\",\n          images: [],\n          skus: [],\n        };\n      },\n    },\n  },\n\n  data() {\n    return {\n      statusBarBottom: 0,\n      btnType: \"\",           // 'cart' | 'buy'\n      selectedSkuIndex: 0,   // ÂΩìÂâçÈÄâ‰∏≠ÁöÑ SKU ‰∏ãÊ†á\n      quantity: 1,           // Êï∞Èáè\n    };\n  },\n\n  mounted() {\n    const windowInfo = uni.getWindowInfo();\n    this.statusBarBottom = windowInfo.safeAreaInsets\n      ? windowInfo.safeAreaInsets.bottom\n      : 0;\n\n    // ÈªòËÆ§ÈÄâ‰∏≠Á¨¨‰∏Ä‰∏™ sku\n    if (this.info && this.info.skus && this.info.skus.length > 0) {\n      this.selectedSkuIndex = 0;\n    }\n  },\n\n  computed: {\n    // ÂΩìÂâçÈÄâ‰∏≠ÁöÑ sku\n    currentSku() {\n      if (this.info && this.info.skus && this.info.skus.length > 0) {\n        return this.info.skus[this.selectedSkuIndex] || {};\n      }\n      return {};\n    },\n\n    // È°∂ÈÉ®Â±ïÁ§∫ÂõæÁâáÔºö‰ºòÂÖà sku.image ‚Üí info.images[0] ‚Üí info.pic\n    displayPic() {\n      if (this.currentSku && this.currentSku.image) {\n        return this.currentSku.image;\n      }\n      if (this.info && this.info.images && this.info.images.length > 0) {\n        return this.info.images[0];\n      }\n      return this.info.pic || \"\";\n    },\n\n    // È°∂ÈÉ®Â±ïÁ§∫‰ª∑Ê†ºÔºö‰ºòÂÖà sku.price ‚Üí info.price\n    displayPrice() {\n      if (this.currentSku && this.currentSku.price) {\n        return this.currentSku.price;\n      }\n      return this.info.price || 0;\n    },\n\n    // ‚ÄúÂ∑≤ÈÄâÔºöxxx‚Äù\n    selectedSkuText() {\n      if (!this.info.skus || this.info.skus.length === 0) {\n        return \"ÈªòËÆ§ËßÑÊ†º\";\n      }\n      const sku = this.currentSku;\n      if (!sku) return \"ÈªòËÆ§ËßÑÊ†º\";\n      return sku.sku_name || \"ÈªòËÆ§ËßÑÊ†º\";\n    },\n  },\n\n  methods: {\n    /**\n     * Â§ñÈÉ®Ë∞ÉÁî®ÔºöÊâìÂºÄÂºπÁ™ó\n     * type: 'cart' | 'buy'\n     */\n    open(type) {\n      this.btnType = type || \"buy\";\n\n      if (!this.info.skus || this.info.skus.length === 0) {\n        this.selectedSkuIndex = 0;\n      } else if (this.selectedSkuIndex >= this.info.skus.length) {\n        this.selectedSkuIndex = 0;\n      }\n\n      this.quantity = 1;\n\n      if (this.$refs.CatPopup && this.$refs.CatPopup.$callMethod) {\n        this.$refs.CatPopup.$callMethod(\"open\");\n      }\n    },\n\n    close() {\n      if (this.$refs.CatPopup && this.$refs.CatPopup.$callMethod) {\n        this.$refs.CatPopup.$callMethod(\"close\");\n      }\n    },\n\n    // ÈÄâÊã© SKU\n    selectSku(index) {\n      this.selectedSkuIndex = index;\n    },\n\n    // ÊîπÊï∞Èáè\n    changeQty(delta) {\n      const next = this.quantity + delta;\n      if (next < 1) return;\n      this.quantity = next;\n    },\n\n    // ‚≠ê‚≠ê Âä†ÂÖ•Ë¥≠Áâ©ËΩ¶ÔºöÁúüÊ≠£Ë∞ÉÁî® /api/cart/add\n    onAddCart() {\n      if (!this.currentSku || !this.currentSku.sku_id) {\n        uni.showToast({ title: \"ËØ∑ÈÄâÊã©ËßÑÊ†º\", icon: \"none\" });\n        return;\n      }\n\n      const openid = uni.getStorageSync(\"openid\");\n      if (!openid) {\n        uni.showToast({ title: \"ËØ∑ÂÖàÁôªÂΩï\", icon: \"none\" });\n        return;\n      }\n\n      const skuId = this.currentSku.sku_id;\n      const qty = this.quantity;\n\n      uni.showLoading({ title: \"Âä†ÂÖ•‰∏≠...\" });\n\n      uni.request({\n        url: `${API_BASE}/api/cart/add`,\n        method: \"POST\",\n        header: {\n          \"content-type\": \"application/json\",\n        },\n        data: {\n          openid: openid,\n          sku_id: skuId,\n          quantity: qty,\n        },\n        success: (res) => {\n          const body = res.data || {};\n          if (body.code === 200) {\n            uni.showToast({\n              title: body.msg || \"Â∑≤Âä†ÂÖ•Ë¥≠Áâ©ËΩ¶\",\n              icon: \"success\",\n            });\n            this.close();\n          } else {\n            uni.showToast({\n              title: body.msg || \"Âä†ÂÖ•Ë¥≠Áâ©ËΩ¶Â§±Ë¥•\",\n              icon: \"none\",\n            });\n          }\n        },\n        fail: () => {\n          uni.showToast({\n            title: \"ÁΩëÁªúÈîôËØØÔºåËØ∑Á®çÂêéÈáçËØï\",\n            icon: \"none\",\n          });\n        },\n        complete: () => {\n          uni.hideLoading();\n        },\n      });\n    },\n\n    formatSkuName(sku, index) {\n      const name = sku.sku_name || \"ËßÑÊ†º \" + (index + 1);\n      return name.replace(/\\//g, \"\");\n    },\n\n    // Á´ãÂç≥Ë¥≠‰π∞\n    onBuy() {\n      if (!this.currentSku || !this.currentSku.sku_id) {\n        uni.showToast({ title: \"ËØ∑ÈÄâÊã©ËßÑÊ†º\", icon: \"none\" });\n        return;\n      }\n\n      const goodsId = this.info.id || 0;\n      const sku = this.currentSku;\n      const qty = this.quantity;\n\n      const orderItem = {\n        product_id: goodsId,\n        sku_id: sku.sku_id,\n        name: this.info.name,\n        sku_name: sku.sku_name || this.selectedSkuText,\n        price: sku.price || this.info.price || 0,\n        quantity: qty,\n        image: sku.image || this.displayPic,\n        attr1: sku.attr1,\n        attr2: sku.attr2,\n        attr3: sku.attr3,\n        attr4: sku.attr4,\n      };\n\n      uni.navigateTo({\n        url: \"/pages/ConfirmOrder/ConfirmOrder\",\n        success: (res) => {\n          const eventChannel = res.eventChannel;\n          eventChannel.emit(\"orderData\", {\n            items: [orderItem],\n            from: \"goodsDetail\",\n          });\n        },\n      });\n    },\n  },\n};\n</script>\n\r\n\n<style lang=\"scss\">\n  @import \"AttrPopup.scss\";\n\n  /* ‰Ω†ÂéüÊù•ÁöÑÊ†∑ÂºèÈáåÂ¶ÇÊûúÊ≤°ÊúâËøôÂá†‰∏™ÔºåÂèØ‰ª•ÁÆÄÂçïË°•‰∏Ä‰∏ã */\n\n  .sku-item {\n    padding: 20rpx 0;\n    border-bottom: 1px solid #f5f5f5;\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n  }\n\n  .sku-item.active {\n    background-color: #fef5f0;\n  }\n\n  .sku-left {\n    width: 120rpx;\n    height: 120rpx;\n    margin-right: 20rpx;\n  }\n\n  .sku-image {\n    width: 100%;\n    height: 100%;\n    border-radius: 12rpx;\n  }\n\n  .sku-right {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n  }\n\n  .sku-name .text {\n    font-size: 28rpx;\n    color: #333;\n  }\n\n  .sku-price-stock {\n    margin-top: 10rpx;\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    justify-content: space-between;\n  }\n\n  .sku-price-stock .price {\n    font-size: 30rpx;\n    font-weight: 600;\n    color: #ff3b30;\n  }\n\n  .sku-price-stock .stock {\n    font-size: 24rpx;\n    color: #999;\n  }\n\n  .empty-sku {\n    padding: 40rpx 0;\n    text-align: center;\n  }\n\n  .empty-sku .text {\n    font-size: 26rpx;\n    color: #999;\n  }\n</style>\n","import Component from 'C:/Users/zrh/Desktop/7600/e-shop/pages/GoodsDetail/components/AttrPopup/AttrPopup.uvue'\nwx.createComponent(Component)"],"names":["defineComponent","uni"],"mappings":"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"}