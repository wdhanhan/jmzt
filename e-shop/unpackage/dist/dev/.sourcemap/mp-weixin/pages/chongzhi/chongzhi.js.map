{"version":3,"file":"chongzhi.js","sources":["pages/chongzhi/chongzhi.uvue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY2hvbmd6aGkvY2hvbmd6aGkudXZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"cashier-page\">\n    <view :style=\"{ height: statusBarHeight + 'px' }\"></view>\n    \n    <view class=\"nav-title\">收银台</view>\n\n    <view class=\"bill-card\">\n      <view class=\"brand-area\">\n        <view class=\"icon-box\">\n          <uni-icons type=\"cart-filled\" size=\"30\" color=\"#07c160\"></uni-icons>\n        </view>\n        <text class=\"shop-name\">聚美优选 · 会员服务</text>\n      </view>\n\n      <view class=\"amount-area\">\n        <text class=\"currency\">￥</text>\n        <text class=\"num\">{{ formatPrice(amount).int }}</text>\n        <text class=\"dec\">.{{ formatPrice(amount).dec }}</text>\n      </view>\n      \n      <view class=\"status-tag\">待支付</view>\n\n      <view class=\"divider\"></view>\n\n      <view class=\"detail-list\">\n        <view class=\"row\">\n          <text class=\"label\">商品说明</text>\n          <text class=\"val highlight\">{{ payDesc || '未知商品' }}</text>\n        </view>\n        <view class=\"row\">\n          <text class=\"label\">订单类型</text>\n          <text class=\"val\">{{ getTypeName(payType) }}</text>\n        </view>\n        <view class=\"row\">\n          <text class=\"label\">支付账户</text>\n          <text class=\"val\">{{ mobile || '当前用户' }}</text>\n        </view>\n        <view class=\"row\">\n          <text class=\"label\">创建时间</text>\n          <text class=\"val\">{{ createTime }}</text>\n        </view>\n      </view>\n    </view>\n\n    <view class=\"action-area\">\n      <button class=\"pay-btn\" hover-class=\"btn-hover\" @click=\"handlePay\" :disabled=\"submitting\">\n        <uni-icons v-if=\"!submitting\" type=\"weixin\" size=\"24\" color=\"#fff\" style=\"margin-right:10rpx\"></uni-icons>\n        <text>{{ submitting ? '正在连接安全支付...' : '立即支付' }}</text>\n      </button>\n      <view class=\"safe-tips\">\n        <uni-icons type=\"locked-filled\" size=\"12\" color=\"#ccc\"></uni-icons>\n        <text>本交易由微信支付提供安全保障</text>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script lang=\"uts\">\n  const WX_APPID = 'wx2ee0ec34076f93e6'\n  const WX_MCHID = '1738346388'\n  const PAY_URL = 'https://jmpay.cxxyonline.cn/'\n\n  export default {\n    data() {\n      return {\n        statusBarHeight: 0,\n        submitting: false,\n        mobile: uni.getStorageSync('mobile') || '',\n        createTime: '',\n        \n        // 核心参数：全部由上个页面传入\n        amount: 0,     // 支付金额\n        payDesc: '',   // 支付描述 (如：购买轻月卡)\n        payType: ''    // 支付类型 (如：light_month)\n      }\n    },\n    onLoad(options: any) {\n      const windowInfo = uni.getWindowInfo()\n      this.statusBarHeight = windowInfo.statusBarHeight || 0\n      \n      // 生成当前时间用于展示\n      const now = new Date()\n      this.createTime = `${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`\n\n      // 接收参数\n      if (options.amount) this.amount = parseFloat(options.amount)\n      if (options.desc) this.payDesc = decodeURIComponent(options.desc)\n      if (options.type) this.payType = options.type\n      \n      // 安全校验\n      if (this.amount <= 0) {\n        uni.showToast({ title: '参数错误:金额无效', icon: 'none' })\n        setTimeout(() => uni.navigateBack(), 1500)\n      }\n    },\n    methods: {\n      formatPrice(v: number) {\n        const s = (v || 0).toFixed(2)\n        const arr = s.split('.')\n        return { int: arr[0], dec: arr[1] || '00' }\n      },\n      getTypeName(type: string) {\n        const map: any = {\n          'light_month': '轻月卡开通',\n          'heavy_month': '重月卡充值',\n          'times_year': '分次年卡',\n          'free_year': '自由年卡',\n          'recharge': '余额充值'\n        }\n        return map[type] || '增值服务'\n      },\n      handlePay() {\n        if (this.submitting) return\n        this.submitting = true\n        \n        // 生成订单号前缀\n        const prefix = this.payType === 'recharge' ? 'RE' : 'ME'\n        const outTradeNo = prefix + Date.now()\n\n        uni.__f__('log','at pages/chongzhi/chongzhi.uvue:120','发起支付:', this.amount, this.payType)\n\n        uni.request({\n          url: PAY_URL,\n          method: 'POST',\n          data: {\n            appid: WX_APPID,\n            mchid: WX_MCHID,\n            description: this.payDesc,\n            outTradeNo: outTradeNo,\n            total: Math.round(this.amount * 100), // 转为分\n            openid: uni.getStorageSync('openid'),\n            attach: this.payType\n          },\n          success: (res: any) => {\n            if (res.statusCode !== 200) {\n              this.showErr('服务暂不可用')\n              return\n            }\n            const p = res.data\n            uni.requestPayment({\n\n              timeStamp: String(p.timeStamp),\n              nonceStr: p.nonceStr,\n              package: p.package,\n              signType: 'RSA',\n              paySign: p.paySign,\n\n              success: () => {\n                uni.showToast({ title: '支付成功', icon: 'success' })\n                setTimeout(() => {\n                    // 支付成功逻辑：如果是充值返回上一页，如果是买会员去会员页\n                    if(this.payType === 'recharge') uni.navigateBack()\n                    else uni.redirectTo({ url: '/pages/member/status' })\n                }, 1500)\n              },\n              fail: () => {\n                uni.showToast({ title: '已取消支付', icon: 'none' })\n              }\n            } as any)\n          },\n          fail: () => {\n            this.showErr('网络连接失败')\n          },\n          complete: () => {\n            this.submitting = false\n          }\n        })\n      },\n      showErr(msg: string) {\n        uni.showModal({ title: '提示', content: msg, showCancel: false })\n      }\n    }\n  }\n</script>\n\n<style lang=\"scss\">\n  /* 页面背景：极简灰 */\n  .cashier-page {\n    min-height: 100vh;\n    background-color: #F2F3F5;\n    padding: 0 40rpx;\n    display: flex;\n    flex-direction: column;\n  }\n\n  /* 顶部标题 */\n  .nav-title {\n    text-align: center;\n    font-size: 36rpx;\n    font-weight: 500;\n    color: #333;\n    padding: 20rpx 0 40rpx;\n  }\n\n  /* 账单卡片：核心视觉 */\n  .bill-card {\n    background: #fff;\n    border-radius: 32rpx;\n    padding: 60rpx 40rpx;\n    box-shadow: 0 10rpx 40rpx rgba(0,0,0,0.03);\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n\n    /* 品牌区 */\n    .brand-area {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      margin-bottom: 40rpx;\n      .icon-box {\n        width: 80rpx; height: 80rpx;\n        background: rgba(7, 193, 96, 0.1);\n        border-radius: 50%;\n        display: flex; align-items: center; justify-content: center;\n        margin-bottom: 16rpx;\n      }\n      .shop-name { font-size: 26rpx; color: #999; }\n    }\n\n    /* 金额区 */\n    .amount-area {\n      display: flex;\n      align-items: baseline;\n      color: #333;\n      margin-bottom: 16rpx;\n      .currency { font-size: 40rpx; font-weight: 500; margin-right: 4rpx; }\n      .num { font-size: 80rpx; font-weight: bold; line-height: 1; font-family: 'DIN', sans-serif; }\n      .dec { font-size: 40rpx; font-weight: 500; }\n    }\n\n    .status-tag {\n      font-size: 24rpx; color: #ff9900; background: #fff8e8;\n      padding: 6rpx 20rpx; border-radius: 20rpx; margin-bottom: 40rpx;\n    }\n\n    /* 虚线分割 */\n    .divider {\n      width: 100%;\n      height: 1px;\n      border-top: 2rpx dashed #eee;\n      position: relative;\n      margin-bottom: 40rpx;\n      \n      /* 两侧圆孔装饰，模仿票据 */\n      &::before, &::after {\n        content: ''; position: absolute; top: -12rpx;\n        width: 24rpx; height: 24rpx; background: #F2F3F5; border-radius: 50%;\n      }\n      &::before { left: -52rpx; }\n      &::after { right: -52rpx; }\n    }\n\n    /* 详情列表 */\n    .detail-list {\n      width: 100%;\n      .row {\n        display: flex; justify-content: space-between; margin-bottom: 24rpx;\n        &:last-child { margin-bottom: 0; }\n        \n        .label { font-size: 28rpx; color: #999; }\n        .val { font-size: 28rpx; color: #333; text-align: right; max-width: 60%; }\n        .highlight { font-weight: bold; font-size: 30rpx; }\n      }\n    }\n  }\n\n  /* 底部按钮区 */\n  .action-area {\n    margin-top: 60rpx;\n    \n    .pay-btn {\n      background-color: #07c160;\n      color: #fff;\n      font-size: 32rpx;\n      font-weight: bold;\n      height: 100rpx;\n      border-radius: 50rpx;\n      display: flex; align-items: center; justify-content: center;\n      box-shadow: 0 20rpx 30rpx rgba(7, 193, 96, 0.2);\n      border: none;\n      \n      &::after { border: none; } /* 去除小程序默认边框 */\n    }\n    .btn-hover { opacity: 0.9; transform: scale(0.98); }\n\n    .safe-tips {\n      margin-top: 30rpx;\n      display: flex; justify-content: center; align-items: center; gap: 8rpx;\n      text { font-size: 24rpx; color: #ccc; }\n    }\n  }\n</style>","import MiniProgramPage from 'C:/Users/zrh/Desktop/7600/e-shop/pages/chongzhi/chongzhi.uvue'\nwx.createPage(MiniProgramPage)"],"names":["defineComponent","uni"],"mappings":"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"}